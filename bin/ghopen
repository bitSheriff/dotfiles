#! /usr/bin/bash

# Get the origin for the current repo.
origin=$(git remote get-url origin 2>/dev/null)

# Bail if we're not in a git repo.
if [[ $? -ne 0 ]]; then
    echo "current dir '$(basename "${PWD}")' is not in a git repo..."
    return
fi

# Determine the platform and set the base URL accordingly.
if [[ "${origin}" == *github.com* ]]; then
    base_url="https://github.com"
elif [[ "${origin}" == *gitlab.com* ]]; then
    base_url="https://gitlab.com"
elif [[ "${origin}" == *codeberg.org* ]]; then
    base_url="https://codeberg.org"
else
    echo "Unsupported git hosting service."
    return
fi

# Extract the org/repo from the origin URL.
org_repo=$(echo "${origin%.git}" | cut -f2 -d: | sed 's/.*@//')

# Construct the full URL.
url="${base_url}/${org_repo}"

# Let the user know what we're opening, formatting org/repo in green, open.
echo -e "opening ${base_url}/\e[32m${org_repo}\e[0m"
python3 -c "import webbrowser; webbrowser.open_new_tab('${url}')"
